<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>해시태그 필터 갤러리</title>
<style>
  /* 베이스 */
  * { box-sizing: border-box; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; line-height: 1.5; }
  .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

  /* 해시태그 바 */
  .filters { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
  .filters button {
    border: 1px solid #e5e7eb; background: #fff; color: #111; 
    border-radius: 999px; padding: 6px 12px; cursor: pointer;
  }
  .filters button.is-active { background: #ffe0e5; border-color: #f0a5b5; }

  /* 갤러리 */
  .gallery {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
  .card {
    border: 1px solid #eee; border-radius: 12px; overflow: hidden; background: #fff;
  }
  .card img { width: 100%; height: 180px; object-fit: cover; display: block; }
  .card .tags { padding: 8px; display: flex; gap: 6px; flex-wrap: wrap; }
  .card .tags a { font-size: 12px; text-decoration: none; color: #d15364; }

  /* 숨김 처리: 접근성 좋게 hidden 속성 사용 */
  .card[hidden] { display: none !important; }
</style>
</head>
<body>
<div class="container">

  <!-- 해시태그 버튼들 -->
  <div class="filters" id="filters">
    <!-- JS가 고유 태그 목록을 자동 생성합니다 -->
    <!-- 수동으로 만들고 싶다면 아래 형식으로:
    <button type="button" data-filter="all" class="is-active">#전체</button>
    <button type="button" data-filter="여행">#여행</button>
    ... -->
  </div>

  <!-- 갤러리: 각 카드에 data-tags="태그1 태그2" -->
  <section class="gallery" id="gallery">
    <article class="card" data-tags="여행 바다 여름">
      <img src="img/photo1.jpg" alt="여름 바다">
      <div class="tags">
        <a href="#여행">#여행</a><a href="#바다">#바다</a><a href="#여름">#여름</a>
      </div>
    </article>

    <article class="card" data-tags="여행 산 겨울">
      <img src="img/photo2.jpg" alt="겨울 산">
      <div class="tags">
        <a href="#여행">#여행</a><a href="#산">#산</a><a href="#겨울">#겨울</a>
      </div>
    </article>

    <article class="card" data-tags="일상 카페 커피">
      <img src="img/photo3.jpg" alt="카페에서 커피">
      <div class="tags">
        <a href="#일상">#일상</a><a href="#카페">#카페</a><a href="#커피">#커피</a>
      </div>
    </article>

    <article class="card" data-tags="여행 도심 야경">
      <img src="img/photo4.jpg" alt="도심 야경">
      <div class="tags">
        <a href="#여행">#여행</a><a href="#도심">#도심</a><a href="#야경">#야경</a>
      </div>
    </article>
  </section>

</div>

<script>
/* ========= 데이터 수집 & 버튼 자동 생성 ========= */
const cards   = [...document.querySelectorAll('.card')];
const filters = document.getElementById('filters');

// 모든 태그 수집
const tagSet = new Set();
cards.forEach(card => card.dataset.tags
  .split(/\s+/).filter(Boolean).forEach(t => tagSet.add(t)));

// "전체" 버튼 + 고유 태그 버튼들 생성
const makeBtn = (label, value, active=false) => {
  const b = document.createElement('button');
  b.type = 'button';
  b.textContent = '#' + label;
  b.dataset.filter = value;
  if (active) b.classList.add('is-active');
  return b;
};
filters.appendChild(makeBtn('전체', 'all', true));
[...tagSet].sort().forEach(tag => filters.appendChild(makeBtn(tag, tag)));

/* ========= 필터 함수 ========= */
function applyFilter(tag){
  // 버튼 active 표시
  document.querySelectorAll('.filters button').forEach(b=>{
    b.classList.toggle('is-active', b.dataset.filter === tag || (tag==='all' && b.dataset.filter==='all'));
  });

  // 카드 표시/숨김
  cards.forEach(card => {
    const tags = card.dataset.tags.split(/\s+/);
    const show = (tag === 'all') || tags.includes(tag);
    card.toggleAttribute('hidden', !show);
  });

  // 주소 해시 업데이트(딥링크)
  if (tag === 'all') history.replaceState(null, '', location.pathname);
  else location.hash = encodeURIComponent(tag);
}

/* ========= 버튼 클릭 이벤트 ========= */
filters.addEventListener('click', (e)=>{
  const btn = e.target.closest('button[data-filter]');
  if (!btn) return;
  applyFilter(btn.dataset.filter);
});

/* ========= 카드 안의 해시태그 링크(#여행 등)도 필터로 동작 ========= */
document.getElementById('gallery').addEventListener('click', (e)=>{
  const a = e.target.closest('a[href^="#"]');
  if (!a) return;
  e.preventDefault();
  const tag = decodeURIComponent(a.getAttribute('href').slice(1));
  applyFilter(tag);
});

/* ========= 최초 로드 시 URL 해시로 필터 적용 ========= */
window.addEventListener('DOMContentLoaded', ()=>{
  const tagFromHash = decodeURIComponent(location.hash.replace('#',''));
  if (tagFromHash && tagSet.has(tagFromHash)) applyFilter(tagFromHash);
});
</script>
</body>
</html>
